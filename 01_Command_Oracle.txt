

###############################################################################
###############   1.1 Ref Steps to check if oracle running or not   ###########
###############################################################################


### Soluction A from internet ###
### http://www.dba-oracle.com/tips_oracle_tnsping_command_example.htm

There are three main things to check when diagnosing remote database connection problems, they are the MACHINE, the LISTENER, and the DATABASE.

1: The ping utility is used to test the connectivity to a remote machine. ping will indicate whether a remote server is accessible and responding. 
   If the ping command indicates that a machine cannot be accessed, the other connectivity tests will also fail.
   
2: Once connectivity to the host is confirmed with ping, the next connection to test is the listener. 
   The tnsping utility is used to determine whether or not an Oracle service can be successfully reached.
     If unsuccessful, a network error will be displayed. However, tnsping will only report if the listener process is up and provides no indication of the state of the database. 
     tnsping <net service name> <count> #<net service name> must exist in the tnsnames.ora file
	 eg: 
	 [oracle@localhost ~]$ tnsping orcl 5

	TNS Ping Utility for Linux: Version 12.1.0.2.0 - Production on 19-JAN-2017 10:17:26

	Copyright (c) 1997, 2014, Oracle.  All rights reserved.

	Used parameter files:


	Used TNSNAMES adapter to resolve the alias
	Attempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = orcl)))
	OK (30 msec)
	OK (0 msec)
	OK (0 msec)
	OK (0 msec)
	OK (0 msec)
	[oracle@localhost ~]$ 

3: Not wirtten. Done


### Solution B from myself###

The quickest way in Linux is using below command, if below command doesn't dispaly oracle instance, that means you may need to use the steps after it, to check where is the problem.
ps -ef | grep pmon

1. ping ipaddress
   ping vmware from hosting maching
   ping hosting maching from vmware
   
2. telnet ipaddress port(1521)
   telnet 192.168.56.2 1521 (If this doesn't work, it may because firewall setting or oracle lisnter doesn't start. In our case, it is oracle listener doesn't start because port confliction)

3. Check if listener working or not
   lsnrctl status (Please refer to step 1.2 in above Section of "###04 PWOB Local Environment setup###")


###############################################################################
#############        1.2 SQlPLUS Reference                    #################
###############################################################################

view /opt/oracle/product/12.1.0/dbhome_1/network/admin/tnsnames.ora
### Reference for Shen's VM ###
# tnsnames.ora Network Configuration File: /opt/oracle/product/12.1.0/dbhome_1/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.

LISTENER_ORCL =
  (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))


ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )

view /opt/oracle/product/12.1.0/dbhome_1/network/admin/listener.ora
### Reference for Shen's VM ###
 # listener.ora Network Configuration File: /opt/oracle/product/12.1.0/dbhome_1/network/admin/listener.ora
# Generated by Oracle configuration tools.

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
 

#http://support.cs.nott.ac.uk/help/docs/databases/oracle/standard/server.101/b12170/qstart.htm#CHDFHFAH
#To start SQL*Plus and connect to a database other than the default

# You may need to find the right user to execute sqlplus command
# 1. Find the right user, if you are not in the right user, please user su command to switch user
$ cat /etc/passwd

# 2. Execute sqlplus
#To connect to a different database from a current command-line session (In VM environment)
connect username/password@connect_identifier (connect_identifier id defined in tnsnames.ora)

# 2.1. Change user to oracle (For my vm linux only)
$su - oracle
Password:oracle
echo $ORACLE_HOME

vi ~/.bash_profile
PATH=$PATH:$HOME/.local/bin:$HOME/bin:$ORACLE_HOME/bin:$ORACLE_HOME/bin
export PATH

sqlplus / as sysdba
SQL>show user;
USER is "SYS"

OR 

sqlplus system/orcl@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.56.2)(PORT = 1521))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = orcl)))
(The password is system/system)

sqlplus system/orcl@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.56.2)(PORT = 1521))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = orcl)))

OR

sqlplus pcd/pcd@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.56.2)(PORT = 1521))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = orcl)))

SQL> desc v$database
SQL> select CONTROLFILE_TYPE , name from v$database; 
CONTROL NAME
------- ---------
CURRENT ORCL

select * from V$DIAG_INFO;

sqlplus username/password@connect_identifier (connect_identifier id defined in tnsnames.ora)
eg:
sqlplus system/orcl@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = orcl)))
sqlplus system/orcl@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.56.2)(PORT = 1521))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = orcl)))
SQL>  select CONTROLFILE_TYPE , name from v$database; 


# 2.2 More sqlplus to reference
#To enable output from PL/SQL blocks with DBMS_OUTPUT.PUT_LINE, use the following:
SQL> SET SERVEROUTPUT ON

#To view all the settings, enter the following at the SQL prompt:
SQL> SHOW ALL

#See log info of oracle
SQL> desc V$DIAG_INFO;
SQL> select name, value from v$diag_info;

#Or try it through web browser ? Not successful 
(The iSQL*Plus Application Server must be running on the middle tier before you can start an iSQL*Plus session)
(To Test If the iSQL*Plus Application Server Has Started Correctly by using below url)
http://127.0.0.1:5560/isqlplus/


###############################################################################
##########     1.3 Oracle database startup and shutdown       #################
###############################################################################

#https://docs.oracle.com/cd/B28359_01/server.111/b28310/start001.htm#ADMIN11141
#start a database
cd $ORACLE_HOME/dbs 
ls -l spfileorcl.ora
STARTUP #(or STARTUP PFILE = $ORACLE_HOME/dbs/init.ora)

#shutdown a database
sqlplus / as sysdba
SQL> show user;
USER is "SYS"
SQL>  select CONTROLFILE_TYPE , name from v$database; 

CONTROL NAME
------- ---------
CURRENT ORCL

SQL> STARTUP
ORACLE instance started.

Total System Global Area 1795162112 bytes
Fixed Size		    2925456 bytes
Variable Size		  553651312 bytes
Database Buffers	 1224736768 bytes
Redo Buffers		   13848576 bytes
Database mounted.
Database opened.
SQL> 

SQL> SHUTDOWN ABORT
#Check Oracle is running or not. In another shell window you can check that pmon is not there
[bpmadm@localhost ~]$  ps -ef | grep pmon
bpmadm   29578 27082  0 14:50 pts/2    00:00:00 grep --color=auto pmon

If the server is down and you try to use sqldeveloper to connet the oracle instance, you will get exception as below:
Status: Failure - Test failed: Listener refused the connection with the following error:ORA-12528, TNS:listener:all appropriate instances are blocked.

SQL> SHUTDOWN NORMAL
ORA-01031: insufficient privileges
SQL> show user;
USER is "SYSTEM"

###############################################################################
##########   1.4 Oracle database user accounts locked or expired    ###########
###############################################################################
Reference link: https://www.symantec.com/connect/articles/how-fix-oracle-users-password-when-it-has-expired
(You need to change user to oracle/oracle)!!!!!!
1. Connect DB
sqlplus /nolog
#No password needed
connect sys as sysdba

2. Modify the default user profile to set the password policies to 'UNLIMITED':
ALTER PROFILE DEFAULT LIMIT COMPOSITE_LIMIT UNLIMITED;

3. Check accounts expiration date
SELECT RESOURCE_NAME,LIMIT FROM DBA_PROFILES WHERE PROFILE='DEFAULT' AND RESOURCE_NAME IN ('FAILED_LOGIN_ATTEMPTS','PASSWORD_LOCK_TIME');
SELECT USERNAME, ACCOUNT_STATUS, EXPIRY_DATE  FROM DBA_USERS WHERE USERNAME in ('BPMUSER', 'PCD', 'ORACLE');

4. Set the updated default password policy profile and reset the password for the user account associated for the Mobility Suite's databases while also unlocking the user account
ALTER USER PCD PROFILE DEFAULT;
connect PCD;
ALTER USER PCD IDENTIFIED BY pcd;
ALTER USER PCD ACCOUNT UNLOCK;

5. If there are still somthing.... check this step...

		
###############################################################################
##########  1.5 Forword request from localhost to your VMWare instance #######
###############################################################################

http://stackoverflow.com/questions/11525703/port-forwarding-in-windows
#Run below command in Hosting Machine (Windows) and run it as adminstrator
netsh interface portproxy add v4tov4 listenport=8120 listenaddress=172.17.90.115 connectport=8120 connectaddress=192.168.56.2 
netsh interface portproxy add v4tov4 listenport=1521 listenaddress=172.17.90.115 connectport=1521 connectaddress=192.168.56.2
netsh interface portproxy add v4tov4 listenport=8080 listenaddress=172.17.90.115 connectport=8080 connectaddress=192.168.56.2
#It can use ssh to access VMWare
netsh interface portproxy add v4tov4 listenport=22 listenaddress=172.17.90.115 connectport=22 connectaddress=192.168.56.2

#1521 is for database
netsh interface portproxy delete v4tov4 listenport=8120 listenaddress=172.17.90.115
netsh interface portproxy delete v4tov4 listenport=1521 listenaddress=172.17.90.115
netsh interface portproxy delete v4tov4 listenport=8080 listenaddress=172.17.90.115
netsh interface portproxy delete v4tov4 listenport=22 listenaddress=172.17.90.115


netsh interface portproxy show all
Listen on ipv4:             Connect to ipv4:

Address         Port        Address         Port
--------------- ----------  --------------- ------
172.17.90.115   8120        192.168.56.2    8120
172.17.90.115   1521        192.168.56.2    1521
172.17.90.115   8080        192.168.56.2    8080

### Start or Stop Tibco BPM Server
cd /home/bpmadm/TIBCO_HOME/tibco/data/tibcohost/Admin-AMX-BPM-AMX-BPM-Server/host/bin
./tibcohost stop
./tibcohost start -clearCache &

###How to tell BPM start or not
ps -ef | grep tibcohost

### TIBCO log path
Your application log (focus on this)
cd /home/bpmadm/TIBCO_HOME/tibco/data/tibcohost/Admin-AMX-BPM-AMX-BPM-Server/data_3.2.x/nodes/BPMNode/logs

System log
cd /home/bpmadm/TIBCO_HOME/tibco/data/tibcohost/Admin-AMX-BPM-AMX-BPM-Server/data_3.2.x/nodes/SystemNode/logs

### Tibco keystore path
cd /home/bpmadm/TIBCO_HOME/tibco/data/bpm/amx.bpm.app/keystores
amx-bpm-wss-keystore.jks


